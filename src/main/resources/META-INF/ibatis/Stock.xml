<?xml version="1.0" encoding="UTF-8"?>
<!--
 * Stock
 *
 * Copyright (c) 2009 Hangzhou ValueSoft Inc., All rights reserved.
 *
 * This software is the confidential and proprietary information of
 * ValueSoft Company. ("Confidential Information").  You shall not
 * disclose such Confidential Information and shall use it only in
 * accordance with the terms of the license agreement you entered into
 * with ValueSoft.com.
 * 
 * Revision History
 * Date      		Programmer       Notes
 * 2013-12-29   	    juning		     Initial
 **********************************************************************
-->

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "/WEB-INF/sql-map-2.dtd">
<sqlMap namespace="Stock_Stock">
    
    <typeAlias alias="stockVO" type="com.j.stock.vo.StockVO"/>

    <resultMap id="stockResult" class="stockVO">
        <result property="id" column="id"/>
        <result property="companyId" column="company_id"/>
        <result property="code" column="code"/>
        <result property="company" column="company"/>
        <result property="currentPrice" column="current_price"/>
        <result property="quoteChangeTd" column="quote_change_td"/>
        <result property="amountChangeTd" column="amount_change_td"/>
        <result property="quoteChangeYa" column="quote_change_ya"/>
        <result property="amountChangeYa" column="amount_change_ya"/>
        <result property="quoteChangeTb" column="quote_change_tb"/>
        <result property="amountChangeTb" column="amount_change_tb"/>
        <result property="amplitude" column="amplitude"/>
        <result property="tradingVolume" column="trading_volume"/>
        <result property="capitalization" column="capitalization"/>
        <result property="marketCap" column="market_cap"/>
        <result property="pe" column="pe"/>
        <result property="dataStatus" column="data_status"/>
        <result property="createdDate" column="created_date"/>
        <result property="modifiedDate" column="modified_date"/>
        <result property="createdBy" column="created_by"/>
        <result property="modifiedBy" column="modified_by"/>
        <result property="stockTitle" column="stock_title"/>
        <result property="stockInfoUrl" column="stock_info_url"/>
        <result property="stockInfoTime" column="stock_info_time"/>
	
    </resultMap>
	<select id="loadStockVOList" resultMap="stockResult" parameterClass="Map">
	    <![CDATA[
	    	select s.* from `stock` s right JOIN member_stock_company m on s.code = m.code
	    	where  s.data_status != 0 and m.data_status != 0 and m.created_by = #createdBy#
	    ]]>
    </select>

    <select id="countStock" resultClass="Long" parameterClass="Map">
	    <![CDATA[
	    	select count(*) from `stock` 
	    	where data_status!=0 and company_id = #companyId# and training_class_id = #trainingClassId#
	    ]]>
    </select>
    
    <select id="loadStockVOById" resultMap="stockResult" parameterClass="Long">
	    <![CDATA[
	    	select * from `stock` where id = #id#
	    ]]>
    </select>
	
	<insert id="insertStockVO" parameterClass="stockVO">
	<![CDATA[
		INSERT INTO `stock` ( 
	            company_id ,
	            code ,
	            company ,
	            current_price ,
	            quote_change_td ,
	            amount_change_td ,
	            quote_change_ya ,
	            amount_change_ya ,
	            quote_change_tb ,
	            amount_change_tb ,
	            amplitude ,
	            trading_volume ,
	            capitalization ,
	            market_cap ,
	            pe ,
	            data_status ,
	            created_date ,
	            modified_date ,
	            created_by ,
	            modified_by ,
	            stock_title ,
	        	stock_info_url  ,
	        	stock_info_time
        )
		VALUES( 
        	    #companyId# ,
        	    #code# ,
        	    #company# ,
        	    #currentPrice# ,
        	    #quoteChangeTd# ,
        	    #amountChangeTd# ,
        	    #quoteChangeYa# ,
        	    #amountChangeYa# ,
        	    #quoteChangeTb# ,
        	    #amountChangeTb# ,
        	    #amplitude# ,
        	    #tradingVolume# ,
        	    #capitalization# ,
        	    #marketCap# ,
        	    #pe# ,
        	    #dataStatus# ,
        	    #createdDate# ,
        	    #modifiedDate# ,
        	    #createdBy# ,
        	    #modifiedBy# ,
        	    #stockTitle# ,
	        #stockInfoUrl# ,
	         #stockInfoTime# 
        )
	]]>
		<selectKey resultClass="long" keyProperty="id">  
	      	<![CDATA[ SELECT LAST_INSERT_ID() AS ID ]]>   
	  	</selectKey>
	</insert>
	
	
	<update id="updateStockVO" parameterClass="stockVO">
	<![CDATA[
	    UPDATE `stock` 
	    SET 
	        company_id = #companyId# ,
	        code = #code# ,
	        company = #company# ,
	        current_price = #currentPrice# ,
	        quote_change_td = #quoteChangeTd# ,
	        amount_change_td = #amountChangeTd# ,
	        quote_change_ya = #quoteChangeYa# ,
	        amount_change_ya = #amountChangeYa# ,
	        quote_change_tb = #quoteChangeTb# ,
	        amount_change_tb = #amountChangeTb# ,
	        amplitude = #amplitude# ,
	        trading_volume = #tradingVolume# ,
	        capitalization = #capitalization# ,
	        market_cap = #marketCap# ,
	        pe = #pe# ,
	        data_status = #dataStatus# ,
	        created_date = #createdDate# ,
	        modified_date = #modifiedDate# ,
	        created_by = #createdBy# ,
	        modified_by = #modifiedBy# ,
	        stock_title = #stockTitle# ,
	        stock_info_url = #stockInfoUrl# ,
	        stock_info_time = #stockInfoTime# 
        WHERE
	        id = #id#
	]]>
	</update>
	
	
	<update id="updateStockNewInfoVO" parameterClass="stockVO">
	<![CDATA[
	    UPDATE `stock` 
	    SET 
	        stock_title = #stockTitle# ,
	        stock_info_url = #stockInfoUrl# ,
	        stock_info_time = #stockInfoTime# 
        WHERE
	        id = #id#
	]]>
	</update>
	
	<update id="deleteStocks" parameterClass="Map">
		<![CDATA[
		    UPDATE `stock` set data_status = 0 ,
	        modified_date = #modifiedDate# ,
	        modified_by = #modifiedBy# 
	         where id in (#idList#)
		]]>
	</update>
	
	<update id="deleteStockVOById" parameterClass="Long">
		<![CDATA[
		    UPDATE `stock` set data_status = 0 ,
	        modified_date = #modifiedDate# ,
	        modified_by = #modifiedBy# 
	         where id=#id#
		]]>
	</update>
	
	<update id="deleteStockVOByCode" parameterClass="Map">
		<![CDATA[
		    UPDATE `stock` set data_status = 0 
	         where code=#code#
		]]>
	</update>
	
	<delete id="deleteStockVOsByCode" parameterClass="Map">
		<![CDATA[
		    delete from `stock`
	         where code=#code#
		]]>
	</delete>
	
	
	
</sqlMap>
